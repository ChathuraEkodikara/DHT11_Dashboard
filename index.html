<!-- Added wifi strength -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Agriculture Dashboard</title>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  margin: 0;
  padding: 20px;
  text-align: center;
}

h1 {
  margin-bottom: 10px;
}

.status-box {
  font-size: 20px;
  margin-bottom: 20px;
}

.container {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 20px;
}

.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 15px;
  width: 260px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.value {
  font-size: 30px;
  margin-top: 10px;
}

.sensor-status {
  margin-top: 10px;
  font-size: 16px;
}

.online { color: #22c55e; }
.offline { color: #ef4444; }
.normal { color: #22c55e; }
.warning { color: #facc15; }
.danger { color: #ef4444; }

</style>
</head>

<body>

<h1>ðŸŒ± Smart Agriculture Dashboard</h1>

<div class="status-box">
  Device Status: <span id="deviceStatus">Checking...</span>
</div>

<div class="container">

  <div class="card">
    <h3>ðŸŒ¡ Temperature</h3>
    <div class="value"><span id="temp">--</span> Â°C</div>
    <div class="sensor-status" id="tempStatus">--</div>
  </div>

  <div class="card">
    <h3>ðŸ’§ Humidity</h3>
    <div class="value"><span id="humidity">--</span> %</div>
    <div class="sensor-status" id="humStatus">--</div>
  </div>

  <div class="card">
    <h3>ðŸŒ¾ Soil Moisture</h3>
    <div class="value"><span id="soil">--</span> %</div>
    <div class="sensor-status" id="soilStatus">--</div>
  </div>

  <div class="card">
    <h3>ðŸ“¶ WiFi Signal</h3>
    <div class="value"><span id="wifi">--</span> dBm</div>
    <div class="sensor-status" id="wifiStatus">--</div>
  </div>

</div>

<script>

/* ---------------- FIREBASE CONFIG ---------------- */

firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  databaseURL: "https://test-project-f4a2b-default-rtdb.firebaseio.com"
});

const db = firebase.database();

/* ---------------- TEMPERATURE ---------------- */

db.ref("sensor/temperature").on("value", snap => {
  if (!snap.exists()) return;

  const temp = snap.val();
  document.getElementById("temp").innerText = temp.toFixed(1);

  let text, cls;

  if (temp < 15) {
    text = "ðŸ”µ Too Cold";
    cls = "warning";
  } else if (temp > 35) {
    text = "ðŸ”´ Too Hot";
    cls = "danger";
  } else {
    text = "ðŸŸ¢ Normal";
    cls = "normal";
  }

  const el = document.getElementById("tempStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* ---------------- HUMIDITY ---------------- */

db.ref("sensor/humidity").on("value", snap => {
  if (!snap.exists()) return;

  const hum = snap.val();
  document.getElementById("humidity").innerText = hum;

  let text, cls;

  if (hum < 40) {
    text = "âš  Dry Air";
    cls = "warning";
  } else if (hum > 80) {
    text = "ðŸ’§ Very Humid";
    cls = "danger";
  } else {
    text = "ðŸŸ¢ Normal";
    cls = "normal";
  }

  const el = document.getElementById("humStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* ---------------- SOIL MOISTURE ---------------- */

db.ref("sensor/soil").on("value", snap => {
  if (!snap.exists()) return;

  const soil = snap.val();
  document.getElementById("soil").innerText = soil;

  let text, cls;

  if (soil < 30) {
    text = "ðŸš¨ Needs Water";
    cls = "danger";
  } else if (soil < 50) {
    text = "âš  Slightly Dry";
    cls = "warning";
  } else {
    text = "ðŸŸ¢ Optimal";
    cls = "normal";
  }

  const el = document.getElementById("soilStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* ---------------- WIFI SIGNAL ---------------- */

db.ref("device/wifiRSSI").on("value", snap => {
  if (!snap.exists()) return;

  const rssi = snap.val();
  document.getElementById("wifi").innerText = rssi;

  let text, cls;

  if (rssi > -50) {
    text = "ðŸŸ¢ Excellent";
    cls = "normal";
  } else if (rssi > -65) {
    text = "ðŸŸ¢ Good";
    cls = "normal";
  } else if (rssi > -75) {
    text = "âš  Weak";
    cls = "warning";
  } else {
    text = "ðŸ”´ Very Weak";
    cls = "danger";
  }

  const el = document.getElementById("wifiStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* ---------------- DEVICE ONLINE/OFFLINE ---------------- */

let lastSeenTime = 0;

db.ref("device/lastSeen").on("value", snap => {
  if (!snap.exists()) return;
  lastSeenTime = snap.val();
});

setInterval(() => {

  if (!lastSeenTime) return;

  const now = Date.now();
  const diff = now - lastSeenTime;

  const el = document.getElementById("deviceStatus");

  if (diff < 10000) {
    el.innerText = "ðŸŸ¢ ONLINE";
    el.className = "online";
  } else {
    el.innerText = "ðŸ”´ OFFLINE";
    el.className = "offline";
  }

}, 2000);

</script>

</body>
</html>
