<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Agriculture Dashboard</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  margin: 0;
  padding: 18px;
  text-align: center;
}

h1 {
  margin-bottom: 10px;
}

.status-box {
  font-size: 18px;
  margin-bottom: 25px;
}

.online { color: #22c55e; }
.offline { color: #ef4444; }

.signal {
  display: inline-flex;
  align-items: flex-end;
  gap: 3px;
  margin-left: 10px;
}

.bar {
  width: 6px;
  background: #334155;
  border-radius: 2px;
  transition: background 0.3s;
}

.bar.active {
  background: #22c55e;
}

.bar:nth-child(1) { height: 6px; }
.bar:nth-child(2) { height: 10px; }
.bar:nth-child(3) { height: 14px; }
.bar:nth-child(4) { height: 18px; }

.container {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 20px;
}

.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 15px;
  width: 260px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.value {
  font-size: 30px;
  margin-top: 10px;
}

.sensor-status {
  margin-top: 10px;
  font-size: 16px;
}

.normal { color: #22c55e; }
.warning { color: #facc15; }
.danger { color: #ef4444; }

</style>
</head>

<body>

<h1>ðŸŒ± Smart Agriculture Dashboard</h1>

<div class="status-box">
  Device Status:
  <span id="deviceStatus">Checking...</span>
  
  WiFi Strength:
  <span class="signal" id="wifiSignal">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </span>
</div>

<div class="container">

  <div class="card">
    <h3>ðŸŒ¡ Temperature</h3>
    <div class="value"><span id="temp">--</span> Â°C</div>
    <div class="sensor-status" id="tempStatus">--</div>
  </div>

  <div class="card">
    <h3>ðŸ’§ Humidity</h3>
    <div class="value"><span id="humidity">--</span> %</div>
    <div class="sensor-status" id="humStatus">--</div>
  </div>

  <div class="card">
    <h3>ðŸŒ¾ Soil Moisture</h3>
    <div class="value"><span id="soil">--</span> %</div>
    <div class="sensor-status" id="soilStatus">--</div>
  </div>

</div>

<script>

/* -------- FIREBASE CONFIG -------- */

firebase.initializeApp({
  apiKey: "AIzaSyAEAGpHaCg0uUIyrsa165zY5xECBn0JpuY",
  databaseURL: "https://test-project-f4a2b-default-rtdb.firebaseio.com"
});

const db = firebase.database();

/* -------- TEMPERATURE -------- */

db.ref("sensor/temperature").on("value", snap => {
  if (!snap.exists()) return;
  const temp = snap.val();
  document.getElementById("temp").innerText = temp.toFixed(1);

  let text, cls;
  if (temp < 15) { text="ðŸ”µ Too Cold"; cls="warning"; }
  else if (temp > 35) { text="ðŸ”´ Too Hot"; cls="danger"; }
  else { text="ðŸŸ¢ Normal"; cls="normal"; }

  const el = document.getElementById("tempStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* -------- HUMIDITY -------- */

db.ref("sensor/humidity").on("value", snap => {
  if (!snap.exists()) return;
  const hum = snap.val();
  document.getElementById("humidity").innerText = hum;

  let text, cls;
  if (hum < 40) { text="âš  Dry Air"; cls="warning"; }
  else if (hum > 80) { text="ðŸ’§ Very Humid"; cls="danger"; }
  else { text="ðŸŸ¢ Normal"; cls="normal"; }

  const el = document.getElementById("humStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* -------- SOIL -------- */

db.ref("sensor/soil").on("value", snap => {
  if (!snap.exists()) return;
  const soil = snap.val();
  document.getElementById("soil").innerText = soil;

  let text, cls;
  if (soil < 30) { text="ðŸš¨ Needs Water"; cls="danger"; }
  else if (soil < 50) { text="âš  Slightly Dry"; cls="warning"; }
  else { text="ðŸŸ¢ Optimal"; cls="normal"; }

  const el = document.getElementById("soilStatus");
  el.innerText = text;
  el.className = "sensor-status " + cls;
});

/* -------- WIFI + DEVICE STATUS -------- */

let wifiRSSI = null;
let lastSeenTime = 0;

db.ref("device/wifiRSSI").on("value", snap => {
  if (!snap.exists()) return;
  wifiRSSI = snap.val();
});

db.ref("device/lastSeen").on("value", snap => {
  if (!snap.exists()) return;
  lastSeenTime = snap.val();
});

setInterval(() => {

  const statusEl = document.getElementById("deviceStatus");
  const bars = document.querySelectorAll("#wifiSignal .bar");

  if (!lastSeenTime) return;

  const now = Date.now();
  const diff = now - lastSeenTime;

  if (diff < 10000) {
    statusEl.innerText = "ðŸŸ¢ ONLINE";
    statusEl.className = "online";

    // Update WiFi Bars
    let level = 0;

    if (wifiRSSI !== null) {
      if (wifiRSSI > -50) level = 4;
      else if (wifiRSSI > -65) level = 3;
      else if (wifiRSSI > -75) level = 2;
      else if (wifiRSSI > -85) level = 1;
      else level = 0;
    }

    bars.forEach((bar, index) => {
      if (index < level) bar.classList.add("active");
      else bar.classList.remove("active");
    });

  } else {
    statusEl.innerText = "ðŸ”´ OFFLINE";
    statusEl.className = "offline";

    // Turn off WiFi bars when offline
    bars.forEach(bar => bar.classList.remove("active"));
  }

}, 2000);

</script>

</body>
</html>


